# Podkop DNS Monitor

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ DNS-—Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è OpenWRT/ImmortalWRT —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

Podkop DNS Monitor ‚Äî —ç—Ç–æ —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –Ω–∞ –±–∞–∑–µ OpenWRT/ImmortalWRT, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ DNS-—Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤ —Å–ª—É—á–∞–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –æ—Å–Ω–æ–≤–Ω—ã–º –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º DNS
- üì° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 1-5 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ cron)
- üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è—Ö
- üìù –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- üîß –ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
- ‚öôÔ∏è –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π DNS-—Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ UDP –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
2. **–†–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º**: –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ DNS –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ DoH (DNS over HTTPS)
3. **–ê–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É DNS –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- OpenWRT –∏–ª–∏ ImmortalWRT
- –ü—Ä–∞–≤–∞ root –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã
- `uci` (—Å–∏—Å—Ç–µ–º–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ OpenWRT)
- `nslookup` (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ DNS)
- `curl` (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Telegram)
- `crontab` (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
- `logger` (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
- `podkop` (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å)

### Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Bot Token –æ—Ç @BotFather
- Chat ID –æ—Ç @userinfobot

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°–∫–∞—á–∞–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
sh <(wget -O - https://raw.githubusercontent.com/SergeyKodolov/podkop-dns-monitor/main/install.sh)
```

### –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–°–∫–∞—á–∞–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç**
   ```bash
   wget https://raw.githubusercontent.com/SergeyKodolov/podkop-dns-monitor/main/install.sh
   chmod +x install.sh
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É**
   ```bash
   ./install.sh
   ```

### –ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–í–æ –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–∞–º –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –≤–≤–µ—Å—Ç–∏:

1. **Telegram Bot Token** - –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç @BotFather –≤ Telegram
2. **Telegram Chat ID** - –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç @userinfobot –≤ Telegram  
3. **Primary DNS Server IP** - IP-–∞–¥—Ä–µ—Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ DNS-—Å–µ—Ä–≤–µ—Ä–∞
4. **DNS Interface** - —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è DNS (–Ω–∞–ø—Ä–∏–º–µ—Ä, `wan`)
5. **Test Domain** - –¥–æ–º–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ DNS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `google.com`)
6. **Backup DNS Server** - —Ä–µ–∑–µ—Ä–≤–Ω—ã–π DNS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `dns.adguard-dns.com`)

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```
Primary DNS: 192.168.1.10
DNS Interface: wan
Test Domain: google.com
Backup DNS: dns.adguard-dns.com
```

## üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞

1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π Bot Token

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID

1. –ù–∞–π–¥–∏—Ç–µ @userinfobot –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à Chat ID –∏–∑ –æ—Ç–≤–µ—Ç–∞

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```bash
/usr/bin/podkop_dns_monitor
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä—É—á–Ω—É—é
/usr/bin/podkop_dns_monitor

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
logread -f | grep podkop-dns-monitor

# –ü—Ä–æ–≤–µ—Ä–∫–∞ cron –∑–∞–¥–∞—á
crontab -l

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ podkop
uci show podkop
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
logread | grep podkop-dns-monitor

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
logread | grep podkop-dns-monitor | grep err

# –õ–æ–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
logread | grep podkop-dns-monitor-install
```

### –°—Ç–∞—Ç—É—Å—ã –≤ –ª–æ–≥–∞—Ö

- `info` - –æ–±—ã—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏)
- `debug` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö
- `warn` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å DNS)
- `err` - –æ—à–∏–±–∫–∏ (–ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏–ª–∏ —Å–ª—É–∂–±–æ–π)

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å—Ç–æ—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã:

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å cron
crontab -e

# –ü—Ä–∏–º–µ—Ä—ã —á–∞—Å—Ç–æ—Ç—ã:
# –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É:     * * * * * /usr/bin/podkop_dns_monitor
# –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:    */5 * * * * /usr/bin/podkop_dns_monitor
# –ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç:   */10 * * * * /usr/bin/podkop_dns_monitor
```

## üîÑ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

**–û—Å–Ω–æ–≤–Ω–æ–π DNS –¥–æ—Å—Ç—É–ø–µ–Ω:**
- –¢–∏–ø: UDP
- –°–µ—Ä–≤–µ—Ä: –£–∫–∞–∑–∞–Ω–Ω—ã–π primary DNS
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

**–û—Å–Ω–æ–≤–Ω–æ–π DNS –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:**
- –¢–∏–ø: DoH (DNS over HTTPS)
- –°–µ—Ä–≤–µ—Ä: –†–µ–∑–µ—Ä–≤–Ω—ã–π DNS
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –ë–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ DNS —á–µ—Ä–µ–∑ `nslookup`
2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã podkop
5. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üîß –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/usr/bin/podkop_dns_monitor`:

```bash
vi /usr/bin/podkop_dns_monitor
```

–ù–∞–π–¥–∏—Ç–µ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```bash
PRIMARY_DNS_SERVER="192.168.1.10"
BACKUP_DNS_SERVER="dns.adguard-dns.com"
DNS_INTERFACE="wan"
TEST_DOMAIN="google.com"
```

### –°–º–µ–Ω–∞ Telegram –Ω–∞—Å—Ç—Ä–æ–µ–∫

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ chat ID
sed -i 's/TELEGRAM_BOT_TOKEN=".*"/TELEGRAM_BOT_TOKEN="NEW_TOKEN"/' /usr/bin/podkop_dns_monitor
sed -i 's/TELEGRAM_CHAT_ID=".*"/TELEGRAM_CHAT_ID="NEW_CHAT_ID"/' /usr/bin/podkop_dns_monitor
```

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ

### –ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

```bash
# –£–¥–∞–ª–∏—Ç—å cron –∑–∞–¥–∞—á—É
crontab -l | grep -v podkop_dns_monitor | crontab -

# –£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
rm -f /usr/bin/podkop_dns_monitor

# –£–¥–∞–ª–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
rm -f /usr/bin/podkop_dns_monitor.backup.*
```

### –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ

```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å cron –∑–∞–¥–∞—á—É
crontab -l | sed 's|^|#|' | grep podkop_dns_monitor | crontab -
```